---
title: "Lab 10 - Space use and resource selection"
output: html_notebook
---

```{r}
require(tidyverse)
require(terra)
require(tidyterra)
require(sf)
```

# Quick background

For this lab, we're going to be using radiotelemetry data from Florida panthers (*Puma concolor coryi*) recorded in south Florida. The Florida panther is critically endangered, and there has been a push to understand space use, home ranges, and resource selection. After being collared with radio transmitters, individual panthers are relocated periodically (every 1-3 days) using airplanes. Most of the telemetry locations are recorded during the morning (7:00 am to 12:00 pm) which is a period of time when panthers are typically resting.

We're going to be using data from 6 panthers, 3 of which are adults, and 3 of which are subadults. We're going to first quantify utilization distributions for these cats, then we will contrast different approaches to understanding resource selection which vary in how they capture spatial and temporal scale.

# The data

First we are going to bring in a landcover raster. 

```{r}


land = rast('https://github.com/ValenteJJ/SpatialEcology/raw/main/Week10/panther_landcover.tif')
plot(land)


```


This landcover map has been aggregated at a 500 m resolution which reflects the approximate grain of telemetry error estimated in this study (489 m). This map was generated by the Florida Fish and Wildlife Commission and contains 43 landcover types, so we're going to simplify it a bit.

```{r}

classification = read.table('https://raw.githubusercontent.com/ValenteJJ/SpatialEcology/main/Week10/resistance%20reclass.txt', header=T) 

# 
# %>% 
#   mutate(ChangeTo = ifelse(Description=='Dryprairie', 9, ChangeTo),
#          Description2 = ifelse(Description=='Dryprairie', 'Grassland', Description2))

head(classification)

unique(classification$Description2)

land = classify(land, classification[,c(1,3)])
# tmp = categories(tmp, value=unique(classification[,c(3,4)]))


# nlcdSimple = nlcd
# nlcdSimple[nlcdSimple==11] = 1 #Wet areas are a 1 now
# nlcdSimple[nlcdSimple %in% c(21, 22, 23, 24)] = 2 #All developed areas are 2
# nlcdSimple[nlcdSimple %in% c(31, 52)] = 3 #Barren land and shrub/scrub are 3
# nlcdSimple[nlcdSimple %in% c(41,42,43)] = 4 #All forest types are 4
# nlcdSimple[nlcdSimple == 71] = 5 #Grassland is 5
# nlcdSimple[nlcdSimple %in% c(81,82)] = 6 #And agriculture is 6
# 
# #Give these numbers category names
# tmp = data.frame('ID' = c(1, 2, 3, 4, 5, 6),
#                  'category' = c('wetland', 'developed', 'open', 'forest', 'grassland', 'agriculture'))
# nlcdSimple = categories(nlcdSimple, value=tmp)

```



```{r}

panthers = st_read('/vsicurl/https://github.com/ValenteJJ/SpatialEcology/raw/main/Week10/panthers.shp') %>% 
  mutate(CatID = as.factor(CatID))



crs(land, proj=T) == crs(panthers, proj=T)


```


```{r}
summary(panthers)
unique(panthers$CatID)

```


```{r}
ggplot()+
  geom_spatraster(data = land, aes(fill=gfchab_500cl2))

plot(land)
points
```

